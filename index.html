<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çŒœæ•¸å­— PK æˆ° 1A2B - éŸ³æ•ˆåŠ å¼·ç‰ˆ</title>
    <style>
        /* --- CSS å¤–è§€è¨­è¨ˆ --- */
        body {
            font-family: 'Comic Sans MS', 'å¾®è»Ÿæ­£é»‘é«”', sans-serif;
            background-color: #ECEFF1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s;
        }

        .game-container {
            background-color: #ffffff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            text-align: center;
            max-width: 500px;
            width: 100%;
            border: 5px solid #CFD8DC;
            transition: border-color 0.5s;
            position: relative; /* ç‚ºäº†æ”¾éœéŸ³æŒ‰éˆ• */
        }

        /* éœéŸ³é–‹é—œ */
        .sound-toggle {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 14px;
            background-color: #f0f0f0;
            padding: 5px 10px;
            border-radius: 15px;
            cursor: pointer;
            user-select: none;
        }

        /* ç©å®¶ç‹€æ…‹é¡¯ç¤º */
        .player-indicator {
            font-size: 24px;
            font-weight: bold;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: white;
            transition: background-color 0.5s;
            margin-top: 10px;
        }

        /* ç©å®¶ 1 ä¸»é¡Œè‰² (è—) */
        .p1-turn body { background-color: #E3F2FD; }
        .p1-turn .game-container { border-color: #2196F3; }
        .p1-turn .player-indicator { background-color: #2196F3; }
        .p1-turn button.guess-btn { background-color: #2196F3; }
        .p1-turn button.guess-btn:hover { background-color: #1976D2; }

        /* ç©å®¶ 2 ä¸»é¡Œè‰² (ç´…) */
        .p2-turn body { background-color: #FFEBEE; }
        .p2-turn .game-container { border-color: #F44336; }
        .p2-turn .player-indicator { background-color: #F44336; }
        .p2-turn button.guess-btn { background-color: #F44336; }
        .p2-turn button.guess-btn:hover { background-color: #D32F2F; }

        .settings-panel {
            margin-bottom: 15px;
            padding: 5px;
            background-color: #f0f0f0;
            border-radius: 10px;
            display: inline-block;
        }

        select { padding: 5px; font-size: 16px; }

        /* æç¤ºå€åŸŸ */
        .hint-area {
            background-color: #F3E5F5;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px dashed #AB47BC;
        }
        .hint-text {
            font-size: 24px;
            letter-spacing: 5px;
            font-weight: bold;
            color: #7B1FA2;
            margin: 5px 0;
        }
        .hint-note { font-size: 12px; color: #888; }
        
        .hint-btn {
            background-color: #9C27B0;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
        }
        .hint-btn:disabled { background-color: #ccc; cursor: not-allowed; }

        .input-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        input {
            padding: 10px;
            font-size: 20px;
            width: 150px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 10px;
            letter-spacing: 5px;
        }

        button.guess-btn {
            padding: 10px 20px;
            font-size: 18px;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .history-list {
            list-style: none;
            padding: 0;
            margin-top: 20px;
            max-height: 250px;
            overflow-y: auto;
            border-top: 2px dashed #ddd;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 18px;
            align-items: center;
        }

        .p-tag {
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 4px;
            color: white;
            margin-right: 8px;
            vertical-align: middle;
        }
        .p1-tag { background-color: #2196F3; }
        .p2-tag { background-color: #F44336; }

        .badge {
            background-color: #eee;
            padding: 2px 8px;
            border-radius: 5px;
            font-weight: bold;
        }
        .badge-4a { background-color: #4CAF50; color: white; }

        .message {
            margin-top: 10px;
            color: #D32F2F;
            font-weight: bold;
            height: 24px;
        }

        .restart-btn {
            display: none;
            margin-top: 20px;
            width: 100%;
            padding: 10px;
            font-size: 18px;
            background-color: #607D8B;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

    </style>
</head>
<body id="mainBody" class="p1-turn">

    <audio id="soundWin" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
    <audio id="soundSwitch" src="https://actions.google.com/sounds/v1/cartoon/cartoon_boing.ogg"></audio>
    <audio id="soundHint" src="https://actions.google.com/sounds/v1/science_fiction/scifi_laser.ogg"></audio>

    <div class="game-container">
        
        <label class="sound-toggle">
            <input type="checkbox" id="muteToggle" checked> ğŸ”Š éŸ³æ•ˆé–‹å•Ÿ
        </label>

        <div class="player-indicator" id="turnIndicator">
            ç¾åœ¨è¼ªåˆ°ï¼šç©å®¶ 1 (è—éšŠ)
        </div>

        <div class="settings-panel">
            <label for="difficulty">é›£åº¦ï¼š</label>
            <select id="difficulty" onchange="changeDifficulty()">
                <option value="3">ç°¡å–® (3å­—)</option>
                <option value="4" selected>æ™®é€š (4å­—)</option>
                <option value="5">å›°é›£ (5å­—)</option>
            </select>
        </div>

        <div class="hint-area">
            <div id="hintDisplay" class="hint-text">â“ â“ â“ â“</div>
            <button onclick="revealOneDigit()" id="hintBtn" class="hint-btn">ğŸ” å·çœ‹ (å…±ç”¨)</button>
            <div class="hint-note">æ³¨æ„ï¼šå·çœ‹æœƒè®“å°æ‰‹ä¹Ÿçœ‹åˆ°ç­”æ¡ˆå–”ï¼</div>
        </div>

        <div class="input-group">
            <input type="text" id="userGuess" placeholder="1234" maxlength="4">
            <button onclick="checkGuess()" id="guessBtn" class="guess-btn">ç¢ºèª</button>
        </div>

        <div id="messageArea" class="message"></div>

        <ul id="historyList" class="history-list"></ul>

        <button onclick="initGame()" id="restartBtn" class="restart-btn">å†ä¾†ä¸€å±€</button>
    </div>

    <script>
        // --- JavaScript é‚è¼¯éƒ¨åˆ† ---

        let secretCode = ""; 
        let currentLength = 4;
        let revealedIndices = new Set(); 
        let currentPlayer = 1;

        // éŸ³æ•ˆæ§åˆ¶
        function playSound(type) {
            // æª¢æŸ¥æ˜¯å¦éœéŸ³
            let isMute = !document.getElementById("muteToggle").checked;
            if (isMute) return;

            let audio;
            if (type === 'win') audio = document.getElementById("soundWin");
            if (type === 'switch') audio = document.getElementById("soundSwitch");
            if (type === 'hint') audio = document.getElementById("soundHint");

            if (audio) {
                audio.currentTime = 0; // æ¯æ¬¡éƒ½å¾é ­æ’­æ”¾
                audio.play().catch(e => console.log("ç€è¦½å™¨é˜»æ“‹è‡ªå‹•æ’­æ”¾ï¼Œéœ€ä½¿ç”¨è€…äº’å‹•å¾Œæ‰èƒ½æ’­æ”¾"));
            }
        }

        // éœéŸ³æŒ‰éˆ•æ–‡å­—åˆ‡æ›
        document.getElementById("muteToggle").addEventListener("change", function() {
            this.parentNode.lastChild.textContent = this.checked ? " ğŸ”Š éŸ³æ•ˆé–‹å•Ÿ" : " ğŸ”‡ éœéŸ³æ¨¡å¼";
        });

        function changeDifficulty() {
            let selectBox = document.getElementById("difficulty");
            currentLength = parseInt(selectBox.value);
            initGame();
        }

        function initGame() {
            let numbers = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9"];
            for (let i = numbers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
            }
            secretCode = numbers.slice(0, currentLength).join("");
            console.log("ç­”æ¡ˆï¼š" + secretCode);

            revealedIndices.clear();
            updateHintDisplay();
            
            let inputField = document.getElementById("userGuess");
            inputField.value = "";
            inputField.disabled = false;
            inputField.maxLength = currentLength; 
            
            let placeholderText = "";
            for(let i=1; i<=currentLength; i++) placeholderText += i;
            inputField.placeholder = placeholderText;

            document.getElementById("historyList").innerHTML = "";
            document.getElementById("messageArea").textContent = "";
            document.getElementById("guessBtn").disabled = false;
            document.getElementById("hintBtn").disabled = false;
            document.getElementById("restartBtn").style.display = "none";

            currentPlayer = 1;
            updatePlayerUI();
        }

        function updatePlayerUI() {
            let body = document.getElementById("mainBody");
            let indicator = document.getElementById("turnIndicator");
            
            body.classList.remove("p1-turn", "p2-turn");
            
            if (currentPlayer === 1) {
                body.classList.add("p1-turn");
                indicator.textContent = "ç¾åœ¨è¼ªåˆ°ï¼šç©å®¶ 1 (è—éšŠ) ğŸ”µ";
            } else {
                body.classList.add("p2-turn");
                indicator.textContent = "ç¾åœ¨è¼ªåˆ°ï¼šç©å®¶ 2 (ç´…éšŠ) ğŸ”´";
            }
            
            document.getElementById("userGuess").focus();
        }

        function updateHintDisplay() {
            let displayText = "";
            for (let i = 0; i < currentLength; i++) {
                if (revealedIndices.has(i)) {
                    displayText += secretCode[i] + " ";
                } else {
                    displayText += "â“ ";
                }
            }
            document.getElementById("hintDisplay").textContent = displayText;
        }

        function revealOneDigit() {
            let availableIndices = [];
            for (let i = 0; i < currentLength; i++) {
                if (!revealedIndices.has(i)) availableIndices.push(i);
            }
            if (availableIndices.length === 0) return;

            let randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
            revealedIndices.add(randomIndex);
            
            // æ’­æ”¾æç¤ºéŸ³æ•ˆ
            playSound('hint');
            
            updateHintDisplay();

            if (revealedIndices.size === currentLength) {
                document.getElementById("hintBtn").disabled = true;
            }
        }

        function checkGuess() {
            let guessInput = document.getElementById("userGuess");
            let guess = guessInput.value;
            let message = document.getElementById("messageArea");

            if (guess.length !== currentLength || isNaN(guess)) {
                message.textContent = `è«‹è¼¸å…¥ ${currentLength} å€‹æ•¸å­—ï¼`;
                return;
            }
            if (new Set(guess).size !== currentLength) {
                message.textContent = "æ•¸å­—ä¸èƒ½é‡è¤‡ï¼";
                return;
            }

            message.textContent = ""; 

            let countA = 0;
            let countB = 0;

            for (let i = 0; i < currentLength; i++) {
                if (guess[i] === secretCode[i]) countA++;
                else if (secretCode.includes(guess[i])) countB++;
            }

            addHistory(guess, countA, countB);

            if (countA === currentLength) {
                // å‹åˆ©ï¼
                message.textContent = `ğŸ‰ æ­å–œï¼ç©å®¶ ${currentPlayer} ç²å‹ï¼`;
                message.style.color = currentPlayer === 1 ? "#2196F3" : "#F44336";
                // æ’­æ”¾å‹åˆ©éŸ³æ•ˆ
                playSound('win');
                endGame();
            } else {
                // å¤±æ•—ï¼Œåˆ‡æ›
                // æ’­æ”¾åˆ‡æ›éŸ³æ•ˆ
                playSound('switch');
                switchPlayer();
                
                guessInput.value = "";
                guessInput.focus();
            }
        }

        function switchPlayer() {
            currentPlayer = (currentPlayer === 1) ? 2 : 1;
            updatePlayerUI();
        }

        function addHistory(guess, a, b) {
            let list = document.getElementById("historyList");
            let listItem = document.createElement("li");
            listItem.className = "history-item";

            let isWin = (a === currentLength);
            let resultBadgeClass = isWin ? "badge badge-4a" : "badge";
            
            let playerTagClass = (currentPlayer === 1) ? "p-tag p1-tag" : "p-tag p2-tag";
            let playerName = (currentPlayer === 1) ? "P1" : "P2";

            listItem.innerHTML = `
                <div>
                    <span class="${playerTagClass}">${playerName}</span>
                    <span>${guess}</span>
                </div>
                <span class="${resultBadgeClass}" style="background-color: ${isWin ? '#4CAF50' : '#eee'}; color: ${isWin ? 'white' : 'black'}">${a}A${b}B</span>
            `;
            
            list.insertBefore(listItem, list.firstChild);
        }

        function endGame() {
            document.getElementById("userGuess").disabled = true;
            document.getElementById("guessBtn").disabled = true;
            document.getElementById("hintBtn").disabled = true;
            document.getElementById("restartBtn").style.display = "block";
            
            for(let i=0; i<currentLength; i++) revealedIndices.add(i);
            updateHintDisplay();
        }

        document.getElementById("userGuess").addEventListener("keypress", function(event) {
            if (event.key === "Enter") {
                checkGuess();
            }
        });

        initGame();

    </script>
</body>
</html>
